<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Portal del Empleado · Tecnomedica Montajes Industriales S.A.</title>
  <meta name="theme-color" content="#1e88e5" />
  <link rel="icon" href="Logo.png" type="image/png" />
  <link rel="stylesheet" href="./assets/app.css" />
  <!-- Supabase global (CDN) -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="app">

    <!-- LOGIN -->
    <div class="card" id="authCard">
      <div class="brand-row">
        <img src="Logo.png" alt="Tecnomedica Montajes Industriales S.A.">
        <div class="title">Tecnomedica Montajes Industriales S.A.</div>
      </div>
      <h2>Iniciar sesión</h2>
      <label for="email">Correo</label>
      <input id="email" type="email" placeholder="correo@dominio.com" autocomplete="username" inputmode="email">
      <label for="password">Contraseña</label>
      <input id="password" type="password" placeholder="••••••••" autocomplete="current-password">
      <div class="row between">
        <button class="btn" id="btnLogin">Entrar</button>
        <button class="link" id="btnForgot">¿Olvidaste tu contraseña?</button>
      </div>
      <div id="msg" class="muted"></div>
    </div>

    <!-- RESET PASSWORD (/reset o type=recovery) -->
    <div class="card" id="resetCard" style="display:none;">
      <div class="brand-row">
        <img src="Logo.png" alt="Tecnomedica Montajes Industriales S.A.">
        <div class="title">Tecnomedica Montajes Industriales S.A.</div>
      </div>
      <h2>Define una nueva contraseña</h2>
      <label for="newPassword">Nueva contraseña</label>
      <input id="newPassword" type="password" placeholder="••••••••" autocomplete="new-password">
      <div class="row">
        <button class="btn" id="btnSetNew">Guardar nueva contraseña</button>
        <button class="link" id="btnCancelReset">Cancelar</button>
      </div>
      <div id="msg2" class="muted"></div>
    </div>

    <!-- HOME (menú) -->
    <div class="card" id="homeCard" style="display:none;">
      <div class="topbar">
        <div class="brand-row no-gap">
          <img src="Logo.png" alt="Tecnomedica Montajes Industriales S.A.">
          <div class="title">Tecnomedica Montajes Industriales S.A.</div>
        </div>
        <button class="btn light" id="btnLogout">Salir</button>
      </div>

      <div class="muted">Bienvenido</div>
      <div id="empName" class="big">—</div>
      <div id="empUid" class="muted m-b">—</div>

      <div class="grid">
        <div class="tile" data-nav="/marcas">
          <div class="k">Marcar IN/OUT</div><div class="s">Registrar entrada o salida con GPS</div>
        </div>
        <div class="tile" data-nav="/proyectos">
          <div class="k">Proyectos</div><div class="s">Ver asignaciones en curso</div>
        </div>
        <div class="tile" data-nav="/licencias">
          <div class="k">Licencias</div><div class="s">Solicitar y revisar historial</div>
        </div>
        <div class="tile" data-nav="/comprobantes">
          <div class="k">Comprobantes</div><div class="s">Descargar tus pagos</div>
        </div>
      </div>
    </div>

    <!-- MARCAS + ASIGNACIÓN A PROYECTOS -->
    <div class="card" id="punchCard" style="display:none;">
      <div class="topbar">
        <h1>Marcar IN/OUT</h1>
        <div class="row">
          <button class="btn light" data-nav="/app">← Menú</button>
          <button class="btn light" id="btnLogout2">Salir</button>
        </div>
      </div>

      <div class="muted">Empleado</div>
      <div id="empName2" class="big">—</div>
      <div id="empUid2" class="muted">—</div>

      <div class="card inner m-t">
        <div class="row between">
          <div>
            <div><b>Estado actual:</b> <span id="statusTxt">—</span></div>
            <div>Horas de hoy: <span id="hoursToday">00:00</span></div>
          </div>
        </div>
      </div>

      <div class="row gap m-t">
        <button class="btn" id="btnIn">Marcar ENTRADA</button>
        <button class="btn light" id="btnOut">Marcar SALIDA</button>
      </div>
      <div id="punchMsg" class="muted m-t"></div>

      <!-- Asignación de proyectos (se muestra al presionar SALIDA con sesión abierta) -->
      <div class="card inner m-t" id="allocPanel" style="display:none;">
        <div class="row between">
          <h3>Asignar tiempo a proyectos</h3>
          <div class="muted">Por distribuir: <span id="allocRemaining">0 min</span></div>
        </div>

        <div class="row m-t">
          <label style="min-width:100px">Cliente</label>
          <select id="clientFilter"></select>
        </div>

        <div id="allocRows" class="m-t"></div>

        <div class="row gap m-t">
          <button class="btn light" id="btnAddAlloc">+ Agregar proyecto</button>
          <button class="btn" id="btnConfirmOut">Confirmar y SALIR</button>
        </div>
        <div id="allocMsg" class="muted m-t"></div>
      </div>

      <div class="card inner m-t">
        <div class="muted m-b-sm">Últimas marcas</div>
        <div id="recentPunches" class="muted">—</div>
      </div>
    </div>

    <!-- Placeholders -->
    <div class="card" id="projectsCard" style="display:none;">
      <div class="topbar"><h1>Proyectos</h1><button class="btn light" data-nav="/app">← Menú</button></div>
      <div class="muted">En construcción. Activaremos pivot <code>employee_projects</code> y RLS.</div>
    </div>
    <div class="card" id="leaveCard" style="display:none;">
      <div class="topbar"><h1>Licencias</h1><button class="btn light" data-nav="/app">← Menú</button></div>
      <div class="muted">En construcción. Usaremos <code>employee_leaves</code> con RLS.</div>
    </div>
    <div class="card" id="payslipsCard" style="display:none;">
      <div class="topbar"><h1>Comprobantes</h1><button class="btn light" data-nav="/app">← Menú</button></div>
      <div class="muted">En construcción. Bucket privado <code>payslips</code> + signed URLs.</div>
    </div>

  </div>

  <!-- App -->
  <script type="module" src="./assets/app.js"></script>
</body>
</html>
