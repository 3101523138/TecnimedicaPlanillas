<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Portal del Empleado · Tecnomedica Montajes Industriales S.A.</title>
  <meta name="theme-color" content="#1e88e5" />
  <link rel="icon" href="Logo.png" type="image/png" />
  <link rel="stylesheet" href="./assets/app.css" />
  <!-- Supabase global (CDN) -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="app">
    <!-- LOGIN -->
    <div class="card" id="authCard">
      <div class="brand-row">
        <img src="Logo.png" alt="Tecnomedica Montajes Industriales S.A.">
        <div class="title">Tecnomedica Montajes Industriales S.A.</div>
      </div>
      <h2>Iniciar sesión</h2>
      <label for="email">Correo</label>
      <input id="email" type="email" placeholder="correo@dominio.com" autocomplete="username" inputmode="email">
      <label for="password">Contraseña</label>
      <input id="password" type="password" placeholder="••••••••" autocomplete="current-password">
      <div class="row between">
        <button class="btn" id="btnLogin">Entrar</button>
        <button class="link" id="btnForgot">¿Olvidaste tu contraseña?</button>
      </div>
      <div id="msg" class="muted"></div>
    </div>

    <!-- RESET PASSWORD (/reset o type=recovery) -->
    <div class="card" id="resetCard" style="display:none;">
      <div class="brand-row">
        <img src="Logo.png" alt="Tecnomedica Montajes Industriales S.A.">
        <div class="title">Tecnomedica Montajes Industriales S.A.</div>
      </div>
      <h2>Define una nueva contraseña</h2>
      <label for="newPassword">Nueva contraseña</label>
      <input id="newPassword" type="password" placeholder="••••••••" autocomplete="new-password">
      <div class="row">
        <button class="btn" id="btnSetNew">Guardar nueva contraseña</button>
        <button class="link" id="btnCancelReset">Cancelar</button>
      </div>
      <div id="msg2" class="muted"></div>
    </div>

    <!-- HOME (menú) -->
    <div class="card" id="homeCard" style="display:none;">
      <div class="topbar">
        <div class="brand-row no-gap">
          <img src="Logo.png" alt="Tecnomedica Montajes Industriales S.A.">
          <div class="title">Tecnomedica Montajes Industriales S.A.</div>
        </div>
        <button class="btn light" id="btnLogout">Salir</button>
      </div>
      <div class="muted">Bienvenido</div>
      <div id="empName" class="big">—</div>
      <div id="empUid" class="muted m-b">—</div>

      <div class="grid">
        <div class="tile" data-nav="/marcas">
          <div class="k">Marcar IN/OUT</div>
          <div class="s">Registrar entrada o salida</div>
        </div>
        <div class="tile" data-nav="/proyectos">
          <div class="k">Proyectos</div><div class="s">Ver asignaciones en curso</div>
        </div>
        <div class="tile" data-nav="/licencias">
          <div class="k">Licencias</div><div class="s">Solicitar y revisar historial</div>
        </div>
        <div class="tile" data-nav="/comprobantes">
          <div class="k">Comprobantes</div><div class="s">Descargar tus pagos</div>
        </div>
      </div>
    </div>

    <!-- MARCAS -->
    <div class="card" id="punchCard" style="display:none;">
      <div class="topbar">
        <!-- Menú flotante y Salir flotante -->
        <div class="row">
          <button class="btn light floating left" data-nav="/app">← Menú</button>
          <button class="btn light" id="btnLogout2">Salir</button>
        </div>
      </div>

      <!-- LOGO ancho como el “Estado actual” -->
      <div class="card inner logoHdr">
        <img class="punchLogo" src="Logo.png" alt="Tecnomedica">
      </div>

      <!-- Estado + Horas de hoy -->
      <div class="card inner statusHdr">
        <div><strong>Estado actual:</strong> <span id="estadoActualText">—</span></div>
        <div><strong>Horas de hoy:</strong> <span id="hoursTodayText">00:00</span></div>
      </div>

      <!-- Identidad (más aire hacia el centro) -->
      <div class="muted">Marcas IN/OUT como</div>
      <div id="empName2" class="big shift-in">—</div>
      <div id="empUid2" class="muted">—</div>

      <!-- ENTRADA: ancho completo -->
      <div class="m-t">
        <button class="btn btnFull btnBig" id="btnIn">Marcar ENTRADA</button>
      </div>

      <div id="punchMsg" class="muted m-t"></div>

      <!-- Últimas marcas -->
      <div class="card inner">
        <div class="listTitle center m-b-sm">Últimas marcas</div>
        <div id="recentPunches" class="punchList">—</div>
      </div>

      <!-- ASIGNACIÓN DE PROYECTOS -->
      <div class="card inner">
        <div class="assignHeader">
          <div class="assignTitle">Asignación de proyectos</div>
          <div class="assignSub">(obligatorio para cerrar)</div>
          <div class="assignHint" id="allocInfo">Debes asignar 00:00 más.</div>
        </div>

        <!-- Franja de filtro Cliente + divisor elegante -->
        <div class="filterStrip">
          <label for="allocClient">Cliente</label>
          <select id="allocClient">
            <option value="">— Todos los clientes —</option>
          </select>
        </div>
        <div class="sectionDivider" aria-hidden="true"></div>

        <!-- Proyectos (select más grande) -->
        <div id="allocContainer" class="m-t"></div>

        <!-- Acciones: +Proyecto y Guardar del mismo ancho -->
        <div class="row column m-t">
          <button class="btn btnWide btnDarker" id="btnAddAlloc">+ Proyecto</button>
          <button class="btn btnWide btnLg" id="btnSaveAlloc">Guardar asignación</button>
        </div>

        <!-- Totales -->
        <div class="row between m-t">
          <div class="muted">
            <strong><span id="allocTotalHM">00:00</span> / <span id="allocRequiredHM">00:00</span></strong> asignados
          </div>
        </div>
      </div>

      <!-- SALIDA: última acción del día (al final) -->
      <div class="m-t">
        <button class="btn success btnFull btnBig" id="btnOut">Marcar SALIDA</button>
      </div>

      <!-- Placeholders -->
      <div class="card" id="projectsCard" style="display:none;">
        <div class="topbar"><h1>Proyectos</h1><button class="btn light" data-nav="/app">← Menú</button></div>
        <div class="muted">En construcción. Activaremos pivot <code>employee_projects</code> y RLS.</div>
      </div>
      <div class="card" id="leaveCard" style="display:none;">
        <div class="topbar"><h1>Licencias</h1><button class="btn light" data-nav="/app">← Menú</button></div>
        <div class="muted">En construcción. Usaremos <code>employee_leaves</code> con RLS.</div>
      </div>
      <div class="card" id="payslipsCard" style="display:none;">
        <div class="topbar"><h1>Comprobantes</h1><button class="btn light" data-nav="/app">← Menú</button></div>
        <div class="muted">En construcción. Bucket privado <code>payslips</code> + signed URLs.</div>
      </div>
    </div>

  </div>

  <!-- App (con cache-bust) -->
  <script type="module" src="./assets/app.js?v=14"></script>
</body>
</html>
